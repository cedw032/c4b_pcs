{"version":3,"sources":["hooks/useSocket.js","utils/debounce.js","hooks/usePersistentState.js","hooks/useMessenger.js","components/ChatBox.js","components/Button.js","components/LoginBox.js","App.js","index.js"],"names":["socket","io","connect","useSocket","listeners","useEffect","Object","entries","forEach","_ref","_ref2","slicedToArray","name","listener","on","_ref3","_ref4","removeEventListener","timeouts","debounce","key","method","period","currentTimeout","clearTimeout","setTimeout","undefined","usePersistentState","initialState","_useState","useState","_useState2","state","setState","previousState","JSON","parse","localStorage","getItem","error","console","stateRef","useRef","current","persist","setItem","stringify","useMessenger","username","peer","_usePersistentState","concat","_usePersistentState2","log","setLog","logRef","addToLog","message","toConsumableArray","from","isBusiness","content","at","moment","toISOString","emit","to","ChatBox","endClient","_useMessenger","_useMessenger2","sendMessage","input","setInput","getMessageClassname","cx","react_default","a","createElement","className","map","i","format","value","onChange","e","target","onKeyDown","Button","props","clicked","setClicked","assign","onClick","LoginBox","onLogin","setError","_useState3","password","_useState4","credentials","setCredentials","credentialsRef","login","components_Button","children","App","setUsername","endClients","setEndClients","components_ChatBox","components_LoginBox","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.850d2fae.chunk.js","sourcesContent":["import {useEffect} from 'react';\nimport io from 'socket.io-client';\n\n//const socket = io.connect('http://localhost:5000');\nconst socket = io.connect();\n\nconst useSocket = listeners => {\n\tuseEffect(() => {\n\t\tObject.entries(listeners).forEach(([name, listener]) => {\n\t\t\tsocket.on(name, listener);\n\t\t});\t\n\n\t\treturn () => {\n\t\t\tObject.entries(listeners).forEach(([name, listener]) => {\n\t\t\t\tsocket.removeEventListener(name, listener);\n\t\t\t});\t\n\t\t};\n\n\t}, []);\n\n\treturn socket;\n};\n\nexport default useSocket;","\nlet timeouts = {};\n\nconst debounce = (key, method, period) => {\n\n\tconst currentTimeout = timeouts[key];\n\n\tif (currentTimeout) clearTimeout(currentTimeout); \n\n\ttimeouts[key] = setTimeout(() => {\n\t\tmethod();\n\t\ttimeouts[key] = undefined;\n\t}, period);\n\n\treturn timeouts[key];\n}\n\nexport default debounce;","import {useState, useEffect, useRef} from 'react';\nimport debounce from '../utils/debounce';\n\nconst usePersistentState  = (key, initialState) => {\n\n\tconst [state, setState] = useState(initialState);\n\n\tuseEffect(() => {\n\t\ttry {\n\t\t\tconst previousState = JSON.parse(localStorage.getItem(key))\n\t\t\tif (previousState) setState(previousState);\n\t\t} catch (error) {console.error(error)}\n\t}, []);\n\n\n\tconst stateRef = useRef();\n\tstateRef.current = state;\n\n\tconst persist = () => {\n\t\tlocalStorage.setItem(key, JSON.stringify(stateRef.current));\n\t}\n\n\tdebounce(\n\t\tkey,\n\t\tpersist,\n\t\t3000\n\t);\n\n\tuseEffect(() => {\n\t\treturn persist;\n\t}, []);\n\n\treturn [\n\t\tstate,\n\t\tsetState\n\t];\n\n};\n\nexport default usePersistentState;","import {useRef} from 'react';\nimport moment from 'moment';\nimport useSocket from './useSocket';\nimport usePersistentState from './usePersistentState';\n\nconst useMessenger = (username, peer) => {\n\n\tconst [log, setLog] = usePersistentState(\n\t\t`messenger-log-${username}-${peer}`, \n\t\t[]\n\t);\n\n\tconst logRef = useRef();\n\tlogRef.current = log;\n\n\tconst addToLog = message => setLog([\n\t\t...logRef.current, \n\t\tmessage,\n\t]);\n\n\tconst socket = useSocket({\n\t\tmessage: message => {\n\t\t\tif (message.from == peer || message.isBusiness) {\n\t\t\t\taddToLog(message);\n\t\t\t}\n\t\t} \n\t});\n\n\tconst sendMessage = content => {\n\n\t\taddToLog({\n\t\t\tcontent,\n\t\t\tat: moment().toISOString(),\n\t\t\tfrom: username,\n\t\t});\n\n\t\tsocket.emit('message', {\n\t\t\tto: peer,\n\t\t\tcontent,\n\t\t});\n\n\t};\n\n\treturn [log, sendMessage]\n};\n\nexport default useMessenger;","import React, {useState} from 'react';\nimport cx from 'classnames';\nimport useMessenger from '../hooks/useMessenger';\nimport moment from 'moment';\n\nconst ChatBox = ({username, endClient}) => {\n\n\tconst [log, sendMessage] = useMessenger(username, endClient);\n\n\tconst [input, setInput] = useState('');\n\n\tconst getMessageClassname = (message) => cx(\n\t\t'message',\n\t\tmessage.from === username && 'self',\n\t\tmessage.from !== username && 'peer',\n\t);\n\n\treturn (\n\t\t<div className='panel message-box'>\n\t\t\t{log.map((message, i) => \n\t\t\t\t<div \n\t\t\t\t\tkey={i}\n\t\t\t\t\tclassName={getMessageClassname(message)}>\n\t\t\t\t\t<span>{moment(message.at).format('h:mma')} - </span>\n\t\t\t\t\t<span>{message.from}: </span>\n\t\t\t\t\t<span>{message.content}</span>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t<input \n\t\t\t\tvalue={input} \n\t\t\t\tonChange={e => setInput(e.target.value)}\n\t\t\t\tonKeyDown={e => {\n\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\tsendMessage(input);\n\t\t\t\t\t\tsetInput('');\n\t\t\t\t\t}\n\t\t\t\t}}/>\n\t\t</div>\n\t);\n}\n\nexport default ChatBox;","import React, {useState, useEffect} from 'react';\nimport cx from 'classnames';\n\nconst Button = (props) => {\n\tconst [clicked, setClicked] = useState(false);\n\n\tconst clickDuration = 140;\n\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tif (clicked) clearTimeout(clicked);\t\t\n\t\t};\n\t}, [clicked]);\n\n\treturn (\n\n\t\t<button {...props}\n\t\t\tonClick={(e) => {\n\t\t\t\tif (props.onClick) props.onClick();\n\n\t\t\t\tif (clicked) clearTimeout(clicked);\n\n\t\t\t\tsetClicked(setTimeout(() => {\n\t\t\t\t\tsetClicked(false);\n\t\t\t\t}, clickDuration));\n\t\t\t}}\n\t\t\tclassName={cx(\n\t\t\t\tprops.className,\n\t\t\t\tclicked && 'clicked'\n\t\t\t)}/>\n\t);\n};\n\nexport default Button;\n\n","import React, {useState, useRef} from 'react';\nimport useSocket from '../hooks/useSocket';\nimport Button from './Button'\n\nconst LoginBox = ({onLogin}) => {\n\n\tconst [error, setError] = useState();\n\tconst [credentials, setCredentials] = useState({\n\t\tusername: '',\n\t\tpassword: '',\n\t});\n\n\tconst credentialsRef = useRef();\n\tcredentialsRef.current = credentials;\n\n\tconst socket = useSocket({\n\t\tlogin: (error) => {\n\t\t\tif (!error) { \n\t\t\t\tconst credentials = credentialsRef.current;\n\t\t\t\tonLogin(credentials.username);\t\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetError(error);\n\t\t}\n\t});\n\n\tconst {\n\t\tusername,\n\t\tpassword,\n\t} = credentials;\n\n\treturn (\n\t\t<div className='panel'>\n\t\t\t{error &&\n\t\t\t\t<span className='error'>{error}</span>\n\t\t\t}\n\t\t\t<div className='row'>\n\t\t\t\t<span>username</span>\n\t\t\t\t<input \n\t\t\t\t\tvalue={username} \n\t\t\t\t\tonChange={e => setCredentials({\n\t\t\t\t\t\tusername: e.target.value,\n\t\t\t\t\t\tpassword,\n\t\t\t\t\t})}/>\n\t\t\t</div>\n\t\t\t<div className='row'>\n\t\t\t\t<span>password</span>\n\t\t\t\t<input \n\t\t\t\t\tvalue={password} \n\t\t\t\t\tonChange={e => setCredentials({\n\t\t\t\t\t\tusername,\n\t\t\t\t\t\tpassword: e.target.value,\n\t\t\t\t\t})}/>\n\t\t\t</div>\n\t\t\t<Button \n\t\t\t\tchildren='Login'\n\t\t\t\tonClick={() => {\n\t\t\t\t\tsocket.emit(\n\t\t\t\t\t\t'login',\n\t\t\t\t\t\t{username, password}\n\t\t\t\t\t);\n\t\t\t\t}}/>\n\t\t</div>\n\t); \n}\n\nexport default LoginBox;","import React, {useState} from 'react';\n\nimport useSocket from './hooks/useSocket';\nimport ChatBox from './components/ChatBox'\nimport LoginBox from './components/LoginBox';\n\nimport './App.css';\n\nfunction App() {\n\n\tconst [username, setUsername] = useState('');\n\n\tconst [endClients, setEndClients] = useState([]);\n\tuseSocket({\n\t\tendClients: setEndClients,\n\t});\n\n\tif (!username) {\n\t\treturn (\n\t\t\t<LoginBox onLogin={setUsername}/>\n\t\t);\n\t} \n\n\treturn (\n\t\t<div className='app'>\n\t\t\t<div className='panel'>\n\t\t\t\t{endClients.map((endClient, i) => \n\t\t\t\t\t<ChatBox\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\tusername={username}\n\t\t\t\t\t\tendClient={endClient}/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}